from bs4 import BeautifulSoup as BS
import requests
import urllib3
import re

url='http://localhost:8983/solr/docscan1/select?q='

hlarguments='&fl=id,date,last_modified,author&hl.fl=content&hl=on'
searchterm='Trump'
#eg='/home/ubuntu/temp/Trump_News_COPYALL/2016-06-11 How Trump Bankrupted Casinos, but Still Earned.doc'

arguments='&fl=id,date,content'


def getSolrResponse(searchterm,arguments):
    searchurl=url+searchterm+arguments
    ses = requests.Session()
    # the session instance holds the cookie. So use it to get/post later
    res=ses.get(searchurl)
    soup=BS(res.content,"html.parser")
    return soup


def getlist(soup):
    resultcount=int(soup.response.result['numfound'])
    result=soup.response.result
    results=[]
    document ={}
    for doc in result:
        document[id]=doc.str.text
        for arr in doc:
            document[arr.attrs['name']]=arr.text
        results.append(document)
    return results

#print(results)
def gethighlights(soup):
    highlights={}
    highlights_all=soup.response.result.next_sibling
    if highlights_all['name']=='highlighting':
        for item in highlights_all:
            #print (item)
            id=item['name']
            highlight=item.arr.text
            highlights[id]=highlight
    return highlights


def getcontents(docid):
    searchterm=r'id:"'+docid+r'"'
    arguments='&fl=id,date,content'
    sp=getSolrResponse(searchterm,arguments)
    res=getlist(sp)
    return res

#res=getlist(sp)
#highlights=gethighlights(sp)

#contents = getcontents(eg)
#result=contents[0]
#print (results['contents'])

